# Copyright Vespa.ai. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
if(NOT CMAKE_HOST_SYSTEM_NAME STREQUAL "Darwin")
set(VESPALIB_DIRECTIO_TESTDIR src/tests/directio)
set(VESPALIB_PROCESS_MEMORY_STATS_TESTDIR src/tests/util/process_memory_stats)
endif()

vespa_define_module(
    DEPENDS
    vespalog

    EXTERNAL_DEPENDS
    lz4
    xxhash
    zstd
    ${VESPA_URING_LIB}
    absl::stacktrace
    absl::symbolize

    APPS
    src/apps/vespa-detect-hostname
    src/apps/vespa-drop-file-from-cache
    src/apps/vespa-probe-io-uring
    src/apps/vespa-resource-limits
    src/apps/vespa-stress-and-validate-memory
    src/apps/vespa-tsan-digest
    src/apps/vespa-validate-hostname

    TESTS
    ${VESPALIB_DIRECTIO_TESTDIR}
    ${VESPALIB_PROCESS_MEMORY_STATS_TESTDIR}
    src/tests/alloc
    src/tests/approx
    src/tests/array
    src/tests/arrayqueue
    src/tests/assert
    src/tests/barrier
    src/tests/barrier_bench
    src/tests/benchmark
    src/tests/benchmark_timer
    src/tests/box
    src/tests/btree
    src/tests/btree/btree-scan-speed
    src/tests/btree/btree-stress
    src/tests/btree/btree_store
    src/tests/component
    src/tests/compress
    src/tests/compression
    src/tests/coro/active_work
    src/tests/coro/async_io
    src/tests/coro/detached
    src/tests/coro/generator
    src/tests/coro/lazy
    src/tests/coro/received
    src/tests/coro/waiting_for
    src/tests/cpu_usage
    src/tests/data/databuffer
    src/tests/data/input_reader
    src/tests/data/lz4_encode_decode
    src/tests/data/memory_input
    src/tests/data/output_writer
    src/tests/data/simple_buffer
    src/tests/data/smart_buffer
    src/tests/datastore/array_store
    src/tests/datastore/array_store_config
    src/tests/datastore/array_store_dynamic_type_mapper
    src/tests/datastore/buffer_stats
    src/tests/datastore/buffer_type
    src/tests/datastore/compact_buffer_candidates
    src/tests/datastore/datastore
    src/tests/datastore/dynamic_array_buffer_type
    src/tests/datastore/fixed_size_hash_map
    src/tests/datastore/free_list
    src/tests/datastore/sharded_hash_map
    src/tests/datastore/unique_store
    src/tests/datastore/unique_store_dictionary
    src/tests/datastore/unique_store_string_allocator
    src/tests/detect_type_benchmark
    src/tests/dotproduct
    src/tests/drop-file-from-cache
    src/tests/dual_merge_director
    src/tests/encoding/base64
    src/tests/exception_classes
    src/tests/execution_profiler
    src/tests/executor
    src/tests/executor_idle_tracking
    src/tests/explore_modern_cpp
    src/tests/fastlib/io
    src/tests/fastlib/text
    src/tests/fastos
    src/tests/fiddle
    src/tests/fileheader
    src/tests/floatingpointtype
    src/tests/fuzzy
    src/tests/fuzzy/table_dfa
    src/tests/gencnt
    src/tests/growablebytebuffer
    src/tests/guard
    src/tests/host_name
    src/tests/hwaccelerated
    src/tests/invokeservice
    src/tests/io/fileutil
    src/tests/io/mapped_file_input
    src/tests/latch
    src/tests/left_right_heap
    src/tests/memory
    src/tests/memorydatastore
    src/tests/metrics
    src/tests/net/async_resolver
    src/tests/net/crypto_socket
    src/tests/net/selector
    src/tests/net/send_fd
    src/tests/net/socket
    src/tests/net/socket_spec
    src/tests/net/sync_crypto_socket
    src/tests/net/tls/auto_reloading_tls_crypto_engine
    src/tests/net/tls/capabilities
    src/tests/net/tls/direct_buffer_bio
    src/tests/net/tls/openssl_impl
    src/tests/net/tls/policy_checking_certificate_verifier
    src/tests/net/tls/protocol_snooping
    src/tests/net/tls/transport_options
    src/tests/nice
    src/tests/objects/identifiable
    src/tests/objects/nbostream
    src/tests/objects/objectdump
    src/tests/objects/objectselection
    src/tests/optimized
    src/tests/overload
    src/tests/polymorphicarray
    src/tests/portal
    src/tests/portal/handle_manager
    src/tests/portal/http_request
    src/tests/portal/reactor
    src/tests/priority_queue
    src/tests/process
    src/tests/programoptions
    src/tests/random
    src/tests/regex
    src/tests/rendezvous
    src/tests/runnable_pair
    src/tests/rusage
    src/tests/rw_spin_lock
    src/tests/sequencedtaskexecutor
    src/tests/sha1
    src/tests/shared_operation_throttler
    src/tests/shared_string_repo
    src/tests/shutdownguard
    src/tests/signalhandler
    src/tests/simple_thread_bundle
    src/tests/singleexecutor
    src/tests/slime
    src/tests/slime/are_equal
    src/tests/slime/external_data_value
    src/tests/slime/summary-feature-benchmark
    src/tests/spin_lock
    src/tests/stash
    src/tests/state_server
    src/tests/stllike
    src/tests/stringfmt
    src/tests/sync
    src/tests/text/lowercase
    src/tests/text/stringtokenizer
    src/tests/text/utf8
    src/tests/thread
    src/tests/time
    src/tests/time_tracer
    src/tests/trace
    src/tests/traits
    src/tests/unwind_message
    src/tests/util
    src/tests/util/generationhandler_stress
    src/tests/util/hamming
    src/tests/util/md5
    src/tests/util/mimalloc
    src/tests/valgrind
    src/tests/visit_ranges
    src/tests/wakeup
    src/tests/zcurve

    LIBS
    src/vespa/fastlib/io
    src/vespa/fastlib/text
    src/vespa/fastlib/text/apps
    src/vespa/fastos
    src/vespa/vespalib
    src/vespa/vespalib/btree
    src/vespa/vespalib/component
    src/vespa/vespalib/coro
    src/vespa/vespalib/crypto
    src/vespa/vespalib/data
    src/vespa/vespalib/data/slime
    src/vespa/vespalib/datastore
    src/vespa/vespalib/encoding
    src/vespa/vespalib/fuzzy
    src/vespa/vespalib/geo
    src/vespa/vespalib/hwaccelerated
    src/vespa/vespalib/io
    src/vespa/vespalib/locale
    src/vespa/vespalib/metrics
    src/vespa/vespalib/net
    src/vespa/vespalib/net/http
    src/vespa/vespalib/net/tls
    src/vespa/vespalib/net/tls/impl
    src/vespa/vespalib/objects
    src/vespa/vespalib/portal
    src/vespa/vespalib/process
    src/vespa/vespalib/regex
    src/vespa/vespalib/stllike
    src/vespa/vespalib/test
    src/vespa/vespalib/text
    src/vespa/vespalib/time
    src/vespa/vespalib/trace
    src/vespa/vespalib/util
)
