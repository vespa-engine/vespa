<?xml version="1.0"?>
<!-- Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>com.yahoo.vespa</groupId>
    <artifactId>parent</artifactId>
    <version>6-SNAPSHOT</version>
    <relativePath>../parent/pom.xml</relativePath>
  </parent>
  <artifactId>container-disc</artifactId>
  <version>6-SNAPSHOT</version>
  <packaging>container-plugin</packaging>
  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>testutil</artifactId>
      <version>${project.version}</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.mockito</groupId>
      <artifactId>mockito-core</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>config-lib</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>provided-dependencies</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.json</groupId>
      <artifactId>json</artifactId>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>component</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.eclipse.jetty</groupId>
      <artifactId>jetty-servlet</artifactId>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>container-core</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>com.yahoo.vespa</groupId>
          <artifactId>config</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>container-messagebus</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>com.yahoo.vespa</groupId>
          <artifactId>config</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>messagebus-disc</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>com.yahoo.vespa</groupId>
          <artifactId>config</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>vespajlib</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>vespalog</artifactId>
      <version>${project.version}</version>
    </dependency>
    <!-- WARNING: These are only here to make bundlification work -->
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>simplemetrics</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>config-bundle</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>searchlib</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>com.yahoo.vespa</groupId>
          <artifactId>config</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>com.yahoo.vespa</groupId>
      <artifactId>configdefinitions</artifactId>
      <version>${project.version}</version>
      <scope>provided</scope>
    </dependency>
    <!-- end WARNING -->
    <!-- Athenz -->
    <dependency>
      <groupId>org.apache.httpcomponents</groupId>
      <artifactId>httpclient</artifactId>
      <scope>compile</scope>
    </dependency>
    <dependency>
      <groupId>org.bouncycastle</groupId>
      <artifactId>bcpkix-jdk15on</artifactId>
      <scope>compile</scope>
    </dependency>
  </dependencies>
  <properties>
    <!-- These versions must be the ones used by the current jersey version (see vespa_jersey2/target/dependency).
         Declared here to clarify what usually needs to be updated after a jersey version upgrade,
         _not_ to enforce particular versions of these dependencies.
         Do not move these to the root pom! -->
    <hk2.version>2.5.0-b05</hk2.version>
    <javassist.version>3.20.0-GA</javassist.version>
    <mimepull.version>1.9.6</mimepull.version>
  </properties>
  <build>
    <plugins>
      <plugin>
        <groupId>com.yahoo.vespa</groupId>
        <artifactId>config-class-plugin</artifactId>
        <version>${project.version}</version>
        <executions>
          <execution>
            <goals>
              <goal>config-gen</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>com.yahoo.vespa</groupId>
        <artifactId>bundle-plugin</artifactId>
        <extensions>true</extensions>
        <configuration>
          <Bundle-Activator>com.yahoo.container.jdisc.osgi.ContainerBundleActivator</Bundle-Activator>
          <discApplicationClass>com.yahoo.container.jdisc.ConfiguredApplication</discApplicationClass>
            <discPreInstallBundle>
                config-bundle-jar-with-dependencies.jar,
                configdefinitions-jar-with-dependencies.jar,
                container-jersey2-jar-with-dependencies.jar,
                container-search-and-docproc-jar-with-dependencies.jar,
                docprocs-jar-with-dependencies.jar,
                jdisc_http_service-jar-with-dependencies.jar,
                vespaclient-container-plugin-jar-with-dependencies.jar,
                vespa-athenz-jar-with-dependencies.jar,
                simplemetrics-jar-with-dependencies.jar,
                defaults-jar-with-dependencies.jar,
                component-jar-with-dependencies.jar,
                zkfacade-jar-with-dependencies.jar,
                <!-- Jersey 2 + Jackson 2 -->
                aopalliance-repackaged-${hk2.version}.jar,
                hk2-api-${hk2.version}.jar,
                hk2-locator-${hk2.version}.jar,
                hk2-utils-${hk2.version}.jar,
                jackson-annotations-${jackson2.version}.jar,
                jackson-core-${jackson2.version}.jar,
                jackson-databind-${jackson2.version}.jar,
                jackson-datatype-jdk8-${jackson2.version}.jar,
                jackson-datatype-jsr310-${jackson2.version}.jar,
                jackson-jaxrs-base-${jackson2.version}.jar,
                jackson-jaxrs-json-provider-${jackson2.version}.jar,
                jackson-module-jaxb-annotations-${jackson2.version}.jar,
                javassist-${javassist.version}.jar,
                javax.ws.rs-api-${javax.ws.rs-api.version}.jar,
                jersey-client-${jersey2.version}.jar,
                jersey-common-${jersey2.version}.jar,
                jersey-container-servlet-${jersey2.version}.jar,
                jersey-container-servlet-core-${jersey2.version}.jar,
                jersey-entity-filtering-${jersey2.version}.jar, <!-- new feature from 2.16, provided for convenience -->
                jersey-guava-${jersey2.version}.jar,
                jersey-media-jaxb-${jersey2.version}.jar,
                jersey-media-json-jackson-${jersey2.version}.jar,
                jersey-media-multipart-${jersey2.version}.jar,
                mimepull-${mimepull.version}.jar, <!-- needed by media-multipart -->
                jersey-server-${jersey2.version}.jar,
                jersey-proxy-client-${jersey2.version}.jar,
                osgi-resource-locator-1.0.1.jar,
                validation-api-1.1.0.Final.jar
                <!-- jersey2 end -->
            </discPreInstallBundle>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
      </plugin>
    </plugins>
  </build>
  <profiles>
    <profile>
      <id>coverage</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>exec-maven-plugin</artifactId>
            <executions>
              <execution>
                <phase>validate</phase>
                <goals>
                  <goal>exec</goal>
                </goals>
              </execution>
            </executions>
            <configuration>
              <executable>rm</executable>
              <workingDirectory>${project.build.directory}</workingDirectory>
              <arguments>
                <argument>-f</argument>
                <argument>generated-sources/vespa-configgen-plugin/com/yahoo/container/jdisc/JdiscBindingsConfig.java</argument>
              </arguments>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
</project>
